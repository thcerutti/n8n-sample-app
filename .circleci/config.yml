version: 2.1

# Define orbs (conjuntos reutilizáveis de configuração)
orbs:
  node: circleci/node@5.1.0
  docker: circleci/docker@2.2.0

# Define workflows
workflows:
  version: 2
  build-test-deploy:
    jobs:
      - build-docker:
          filters:
            branches:
              only:
                - main

# Define jobs
jobs:
  build-docker:
    executor: docker/docker
    steps:
      - checkout
      - setup_remote_docker:
          docker_layer_caching: true
      - run:
          name: Construir imagem Docker
          command: |
            docker build -t $CIRCLE_PROJECT_REPONAME:latest .
      - run:
          name: Sobe para Docker Hub
          command: |
            echo $DOCKERHUB_ACCESS_TOKEN | docker login -u $DOCKERHUB_USERNAME --password-stdin
            docker push $CIRCLE_PROJECT_REPONAME:latest
